function h = spectrogramOverTime2(power,frequency,maxFrequency)

% clims = [-4 2];

for i = 1:length(power);
    
oneWindowPower = power{i};
oneWindowFreq = frequency{i};

if size(oneWindowPower,2) > 1;
    toPlotPower = mean(oneWindowPower,2);
    toPlotFreq = oneWindowFreq(:,1);
else
    toPlotPower = oneWindowPower;
    toPlotFreq = oneWindowFreq;
end

if nargin>2

% freqIndex = toPlotFreq<maxFrequency & toPlotFreq > minFrequency;
freqIndex = toPlotFreq<maxFrequency;

spectPower(:,i) = toPlotPower(freqIndex);
spectFreq(:,i) = toPlotFreq(freqIndex);

else    
    spectPower(:,i) = toPlotPower;
    spectFreq(:,i) = toPlotFreq;
end

end

if nargin>2

for k = 1:size(spectFreq,1);
    toLabel{k} = num2str(round(spectFreq(k,1)));
end

end

% h = imagesc(spectFreq,'CData',spectPower,clims);


for jj = 1:size(spectPower,1);
    spectPower(jj,:) = smooth(spectPower(jj,:),'sgolay');
end

% spectPower = smooth(spectPower);

h = imagesc(spectFreq,'CData',spectPower);
h = colorbar; 

% ylabel(h, 'Power (dB)');
% ylabel(h, 'Z Score');
ylabel(h, 'Normalized Power');


if nargin>2

ax = gca;
ax.YTick = 1:size(spectFreq,1);
ax.YTickLabel = toLabel;

end

ylabel('hz'); xlabel('Time');
    



